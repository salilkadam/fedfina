apiVersion: v1
kind: Namespace
metadata:
  name: fedfina
---

# Test Backend Deployment with environment verification
apiVersion: apps/v1
kind: Deployment
metadata:
  name: fedfina-backend-test
  namespace: fedfina
spec:
  replicas: 1
  selector:
    matchLabels:
      app: fedfina-backend-test
  template:
    metadata:
      labels:
        app: fedfina-backend-test
    spec:
      containers:
        - name: backend-test
          image: python:3.11-slim
          command: ["/bin/bash"]
          args: ["-c", "while true; do echo 'Environment variables loaded successfully'; sleep 30; done"]
          env:
            - name: ENV
              value: "production"
            - name: API_SECRET_KEY
              valueFrom:
                secretKeyRef:
                  name: fedfina-secrets
                  key: api-secret-key
            - name: DATABASE_URL
              valueFrom:
                secretKeyRef:
                  name: fedfina-secrets
                  key: database-url
            - name: OPENAI_API_KEY
              valueFrom:
                secretKeyRef:
                  name: fedfina-secrets
                  key: openai-api-key
            - name: ELEVENLABS_API_KEY
              valueFrom:
                secretKeyRef:
                  name: fedfina-secrets
                  key: elevenlabs-api-key
            - name: ELEVENLABS_WEBHOOK_SECRET
              valueFrom:
                secretKeyRef:
                  name: fedfina-secrets
                  key: elevenlabs-webhook-secret
            - name: MINIO_ENDPOINT
              valueFrom:
                secretKeyRef:
                  name: fedfina-secrets
                  key: minio-endpoint
            - name: MINIO_ACCESS_KEY
              valueFrom:
                secretKeyRef:
                  name: fedfina-secrets
                  key: minio-access-key
            - name: MINIO_SECRET_KEY
              valueFrom:
                secretKeyRef:
                  name: fedfina-secrets
                  key: minio-secret-key
            - name: MINIO_SECURE
              value: "false"
            - name: REDIS_URL
              valueFrom:
                secretKeyRef:
                  name: fedfina-secrets
                  key: redis-url
            - name: SMTP_FROM_EMAIL
              value: "info@bionicaisolutions.com"
            - name: SMTP_FROM_NAME
              value: "Postprocess API"
            - name: SMTP_USE_CC
              valueFrom:
                secretKeyRef:
                  name: fedfina-secrets
                  key: smtp-use-cc
            - name: DEFAULT_TIMEZONE
              valueFrom:
                secretKeyRef:
                  name: fedfina-secrets
                  key: default-timezone
            - name: TIMEZONE_OFFSET_HOURS
              valueFrom:
                secretKeyRef:
                  name: fedfina-secrets
                  key: timezone-offset-hours
            - name: TIMEZONE_OFFSET_MINUTES
              valueFrom:
                secretKeyRef:
                  name: fedfina-secrets
                  key: timezone-offset-minutes
            - name: BUSINESS_START_HOUR
              valueFrom:
                secretKeyRef:
                  name: fedfina-secrets
                  key: business-start-hour
            - name: BUSINESS_END_HOUR
              valueFrom:
                secretKeyRef:
                  name: fedfina-secrets
                  key: business-end-hour
            - name: ENABLE_IST_TIMEZONE
              valueFrom:
                secretKeyRef:
                  name: fedfina-secrets
                  key: enable-ist-timezone
            - name: SHOW_TIMEZONE_INFO
              valueFrom:
                secretKeyRef:
                  name: fedfina-secrets
                  key: show-timezone-info
            - name: DISABLE_EMAIL_SENDING
              valueFrom:
                secretKeyRef:
                  name: fedfina-secrets
                  key: disable-email-sending
            - name: CALLBACK_ENABLED
              valueFrom:
                secretKeyRef:
                  name: fedfina-secrets
                  key: callback-enabled
            - name: CALLBACK_URL
              valueFrom:
                secretKeyRef:
                  name: fedfina-secrets
                  key: callback-url
            - name: CALLBACK_TIMEOUT_SECONDS
              valueFrom:
                secretKeyRef:
                  name: fedfina-secrets
                  key: callback-timeout-seconds
          resources:
            requests:
              cpu: 100m
              memory: 128Mi
            limits:
              cpu: 500m
              memory: 512Mi
---

# Test Service
apiVersion: v1
kind: Service
metadata:
  name: fedfina-backend-test
  namespace: fedfina
spec:
  selector:
    app: fedfina-backend-test
  ports:
    - protocol: TCP
      port: 8000
      targetPort: 8000
  type: ClusterIP
